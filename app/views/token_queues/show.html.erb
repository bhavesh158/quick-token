<div
  class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden bg-background-light font-display text-slate-900"
  data-queue-view="customer"
  data-queue-token="<%= @token_queue.unique_token %>"
  data-customer-id="<%= @current_customer&.id %>"
  data-queue-status="<%= json_escape(@queue_status.to_json) %>"
>
  <div class="layout-container flex h-full grow flex-col">
    <header class="sticky top-0 z-50 flex items-center justify-between whitespace-nowrap border-b border-solid border-slate-200 bg-white px-6 py-4 lg:px-40 backdrop-blur-md">
      <div class="flex items-center gap-4">
        <div class="size-8 text-primary">
          <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M36.7273 44C33.9891 44 31.6043 39.8386 30.3636 33.69C29.123 39.8386 26.7382 44 24 44C21.2618 44 18.877 39.8386 17.6364 33.69C16.3957 39.8386 14.0109 44 11.2727 44C7.25611 44 4 35.0457 4 24C4 12.9543 7.25611 4 11.2727 4C14.0109 4 16.3957 8.16144 17.6364 14.31C18.877 8.16144 21.2618 4 24 4C26.7382 4 29.123 8.16144 30.3636 14.31C31.6043 8.16144 33.9891 4 36.7273 4C40.7439 4 44 12.9543 44 24C44 35.0457 40.7439 44 36.7273 44Z" fill="currentColor"></path></svg>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-tight text-slate-900"><%= @token_queue.name %></h2>
      </div>
      <div class="flex gap-3">
        <button class="flex h-10 w-10 items-center justify-center rounded-lg bg-slate-100 text-slate-700">
          <span class="material-symbols-outlined text-[20px]">notifications</span>
        </button>
        <button class="flex h-10 w-10 items-center justify-center rounded-lg bg-slate-100 text-slate-700">
          <span class="material-symbols-outlined text-[20px]">account_circle</span>
        </button>
      </div>
    </header>

    <main class="flex flex-1 justify-center py-8 px-4 lg:px-40">
      <div class="layout-content-container flex w-full max-w-[520px] flex-col gap-6 pb-20">
        <% if flash[:notice].present? %>
          <div class="rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-800"><%= flash[:notice] %></div>
        <% end %>
        <% if flash[:alert].present? %>
          <div class="rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700"><%= flash[:alert] %></div>
        <% end %>

        <div class="rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
          <h2 class="text-lg font-semibold text-slate-800 mb-4">Join the Queue</h2>
          <%= form_with(model: @join_customer, url: join_queue_path(token_queue_token: @token_queue.unique_token), html: { class: "flex flex-col gap-4" }) do |form| %>
            <div>
              <%= form.label :name, "Your Name", class: "mb-1 block text-sm font-medium text-slate-700" %>
              <%= form.text_field :name, required: true, placeholder: "Enter your name", class: "w-full rounded-lg border border-slate-300 px-3 py-2" %>
            </div>
            <%= form.submit "Join Queue", class: "w-full rounded-lg bg-primary px-4 py-2 font-bold text-white shadow-lg shadow-primary/30" %>
          <% end %>
          <% if @current_customer %>
            <div class="mt-3">
              <%= form_with(url: leave_queue_path(token_queue_token: @token_queue.unique_token, id: @current_customer.id), method: :delete) do |form| %>
                <%= form.submit "Leave Queue", id: "leave-queue-button", class: "w-full rounded-lg border-2 border-slate-200 px-4 py-2 font-bold text-slate-600 hover:bg-red-50 hover:text-red-600 hover:border-red-200" %>
              <% end %>
            </div>
          <% else %>
            <button id="leave-queue-button" class="mt-3 flex w-full items-center justify-center rounded-lg h-12 bg-transparent border-2 border-slate-200 text-slate-600 font-bold" disabled>Leave Queue</button>
          <% end %>
        </div>

        <div class="flex flex-col items-center space-y-2 text-center">
          <div class="flex items-center gap-2 rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold uppercase tracking-wider text-emerald-700">
            <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span></span>
            Live Updates
          </div>
        </div>

        <div class="relative overflow-hidden rounded-xl bg-primary p-8 text-center text-white shadow-xl shadow-primary/20">
          <div class="absolute top-0 right-0 -mr-8 -mt-8 h-32 w-32 rounded-full bg-white/10 blur-2xl"></div>
          <div class="absolute bottom-0 left-0 -ml-8 -mb-8 h-24 w-24 rounded-full bg-black/10 blur-xl"></div>
          <span class="relative z-10 mb-1 text-sm font-medium uppercase tracking-widest opacity-90">Your Position</span>
          <div class="relative z-10 mb-4 text-7xl font-extrabold" id="customer-position">-</div>
          <div class="relative z-10 mb-6 h-1 w-full rounded-full bg-white/20"><div class="h-full w-1/4 rounded-full bg-white"></div></div>
          <div class="relative z-10 inline-flex items-center gap-2 rounded-lg bg-white/10 px-4 py-2 text-sm font-medium backdrop-blur-sm">
            <span class="material-symbols-outlined text-sm">timer</span>
            <span id="estimated-wait">N/A</span>
          </div>
        </div>

        <div class="grid grid-cols-1 gap-4">
          <div class="flex items-center justify-between rounded-xl border border-slate-200 bg-white p-6 shadow-sm">
            <div class="flex flex-col">
              <span class="text-sm font-medium text-slate-500">Currently Serving</span>
              <span class="text-2xl font-bold text-slate-900" id="now-serving">No one yet</span>
            </div>
            <div class="size-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary"><span class="material-symbols-outlined text-3xl">support_agent</span></div>
          </div>
        </div>

        <div class="overflow-hidden rounded-xl border border-slate-200 bg-white">
          <div class="flex items-center justify-between border-b border-slate-100 p-4">
            <h3 class="font-bold text-slate-800">Queue Activity</h3>
            <span class="text-xs font-semibold text-primary" id="people-ahead">Join to get your place</span>
          </div>
          <div id="queue-list" class="divide-y divide-slate-100"></div>
        </div>

        <div class="mt-1 rounded-lg bg-slate-100 p-4 flex gap-3 items-start">
          <span class="material-symbols-outlined text-primary">info</span>
          <p class="text-xs leading-relaxed text-slate-600">Keep this page open to receive real-time updates.</p>
          <span id="total-waiting" class="hidden"></span>
        </div>
      </div>
    </main>
  </div>
</div>
